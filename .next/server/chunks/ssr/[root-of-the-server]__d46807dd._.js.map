{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nabil/OneDrive/Bureau/projet%20epsizone%20-%20Copie/projet-nabil-et-pedro-open-innov/src/lib/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = 'https://fbbsameldccmlnxpugpn.supabase.co';\r\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiYnNhbWVsZGNjbWxueHB1Z3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NDMyMTMsImV4cCI6MjA2NDUxOTIxM30.OLz7Xl3U41VA-jVXDwLDVOV0qG5ivwFcIF_uuCnL5M4';\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,cAAc;AACpB,MAAM,kBAAkB;AAEjB,MAAM,WAAW,CAAA,GAAA,uLAAA,CAAA,eAAY,AAAD,EAAE,aAAa","debugId":null}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nabil/OneDrive/Bureau/projet%20epsizone%20-%20Copie/projet-nabil-et-pedro-open-innov/src/app/admin/messages/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '../../../lib/supabaseClient';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function AdminMessages() {\r\n  const [dossiers, setDossiers] = useState([]);\r\n  const [selectedDossier, setSelectedDossier] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [isSending, setIsSending] = useState(false);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    fetchDossiers();\r\n  }, []);\r\n\r\n  const fetchDossiers = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('dossiers')\r\n        .select('*')\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setDossiers(data);\r\n    } catch (error) {\r\n      console.error('Erreur lors de la récupération des dossiers:', error);\r\n    }\r\n  };\r\n\r\n  const fetchMessages = async (dossierId) => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('conversations')\r\n        .select('*')\r\n        .eq('dossier_id', parseInt(dossierId))\r\n        .order('created_at', { ascending: true });\r\n\r\n      if (error) throw error;\r\n      setMessages(data);\r\n    } catch (error) {\r\n      console.error('Erreur lors de la récupération des messages:', error);\r\n    }\r\n  };\r\n\r\n  const handleDossierSelect = async (dossier) => {\r\n    setSelectedDossier(dossier);\r\n    await fetchMessages(dossier.id);\r\n  };\r\n\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedDossier) return;\r\n\r\n    try {\r\n      setIsSending(true);\r\n      const { data, error } = await supabase\r\n        .from('conversations')\r\n        .insert([{\r\n          dossier_id: parseInt(selectedDossier.id),\r\n          message: newMessage,\r\n          is_ai: true\r\n        }])\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      setMessages(prev => [...prev, data[0]]);\r\n      setNewMessage('');\r\n    } catch (error) {\r\n      console.error('Erreur lors de l\\'envoi du message:', error);\r\n      alert('Erreur lors de l\\'envoi du message');\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen  p-10 text-primary\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12\">\r\n        <div className=\"flex justify-between items-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-primary\">Messages des utilisateurs</h1>\r\n          <button\r\n            onClick={() => router.push('/admin')}\r\n            className=\" hover:bg-accent text-white px-4 py-2 rounded-lg font-semibold transition\"\r\n          >\r\n            Retour au tableau de bord\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n          {/* Liste des dossiers */}\r\n          <div className=\"bg-gray-100 border border-primary rounded-2xl p-6 shadow-md\">\r\n            <h2 className=\"text-xl font-semibold text-primary mb-4\">Dossiers</h2>\r\n            <div className=\"space-y-2\">\r\n              {dossiers.map((dossier) => (\r\n                <button\r\n                  key={dossier.id}\r\n                  onClick={() => handleDossierSelect(dossier)}\r\n                  className={`w-full text-left p-3 rounded-lg font-semibold transition\r\n                    ${selectedDossier?.id === dossier.id ? 'bg-primary text-white' : ' text-primary border border-primary hover:bg-accent/10'}`}\r\n                >\r\n                  <p className=\"font-medium\">{dossier.nom}</p>\r\n                  <p className=\"text-sm opacity-75\">\r\n                    Créé le {new Date(dossier.created_at).toLocaleDateString()}\r\n                  </p>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Section Conversation */}\r\n          <div className=\"md:col-span-2 bg-gray-100 border border-primary rounded-2xl p-6 shadow-md\">\r\n            {selectedDossier ? (\r\n              <>\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                  <h2 className=\"text-xl font-semibold text-primary\">\r\n                    Conversation avec {selectedDossier.nom}\r\n                  </h2>\r\n                </div>\r\n                <div className=\"flex flex-col h-[600px]  rounded-lg border border-primary\">\r\n                  <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\r\n                    {messages.length === 0 ? (\r\n                      <div className=\"text-center text-gray-400 py-8\">\r\n                        <p>Aucun message</p>\r\n                        <p className=\"text-sm mt-2\">Attendez que l'utilisateur envoie un message</p>\r\n                      </div>\r\n                    ) : (\r\n                      messages.map((message) => (\r\n                        <div\r\n                          key={message.id}\r\n                          className={`w-full flex ${message.is_ai ? 'justify-start' : 'justify-end'}`}\r\n                        >\r\n                          <div\r\n                            className={`max-w-[80%] p-4 rounded-lg flex flex-col shadow\r\n                              ${message.is_ai\r\n                                ? 'bg-primary text-white rounded-tl-none'\r\n                                : 'bg-accent/10 text-primary rounded-tr-none border border-accent'}\r\n                            `}\r\n                          >\r\n                            {message.is_ai && (\r\n                              <span className=\"text-xs font-bold text-accent mb-1 flex items-center gap-1\">\r\n                                <span className=\"inline-block w-4 h-4 bg-accent rounded-full text-center text-white mr-1\">A</span> Admin\r\n                              </span>\r\n                            )}\r\n                            <p className=\"text-sm\">{message.message}</p>\r\n                            <p className=\"text-xs opacity-75 mt-2\">\r\n                              {new Date(message.created_at).toLocaleString()}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                  <div className=\"border-t border-primary p-4 bg-gray-50 rounded-b-lg\">\r\n                    <form onSubmit={handleSendMessage} className=\"flex gap-2\">\r\n                      <input\r\n                        type=\"text\"\r\n                        value={newMessage}\r\n                        onChange={(e) => setNewMessage(e.target.value)}\r\n                        placeholder=\"Écrivez votre réponse...\"\r\n                        className=\"flex-1  border border-primary text-primary rounded-lg px-4 py-2 focus:border-accent\"\r\n                        disabled={isSending}\r\n                      />\r\n                      <button\r\n                        type=\"submit\"\r\n                        className=\"bg-primary hover:bg-accent text-white px-4 py-2 rounded-lg font-semibold transition disabled:opacity-50\"\r\n                        disabled={!newMessage.trim() || isSending}\r\n                      >\r\n                        {isSending ? 'Envoi...' : 'Envoyer'}\r\n                      </button>\r\n                    </form>\r\n                  </div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <div className=\"text-center text-gray-400 py-8\">\r\n                <p>Sélectionnez un dossier pour voir les messages</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}