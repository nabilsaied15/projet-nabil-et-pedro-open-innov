{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nabil/OneDrive/Bureau/projet%20epsizone%20-%20Copie/projet-nabil-et-pedro-open-innov/src/lib/supabaseClient.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = 'https://fbbsameldccmlnxpugpn.supabase.co';\r\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZiYnNhbWVsZGNjbWxueHB1Z3BuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5NDMyMTMsImV4cCI6MjA2NDUxOTIxM30.OLz7Xl3U41VA-jVXDwLDVOV0qG5ivwFcIF_uuCnL5M4';\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,cAAc;AACpB,MAAM,kBAAkB;AAEjB,MAAM,WAAW,CAAA,GAAA,uLAAA,CAAA,eAAY,AAAD,EAAE,aAAa","debugId":null}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nabil/OneDrive/Bureau/projet%20epsizone%20-%20Copie/projet-nabil-et-pedro-open-innov/src/app/dossiers/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '../../lib/supabaseClient';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function DossiersPage() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState(null);\r\n  const [dossiers, setDossiers] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedDossier, setSelectedDossier] = useState(null);\r\n  const [passwordInput, setPasswordInput] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [dossierOffres, setDossierOffres] = useState({});\r\n  const [showAddDossierForm, setShowAddDossierForm] = useState(false);\r\n  const [newDossier, setNewDossier] = useState({ nom: '', mot_de_passe: '' });\r\n\r\n  useEffect(() => {\r\n    const storedUser = JSON.parse(localStorage.getItem('user'));\r\n    if (storedUser) {\r\n      setUser(storedUser);\r\n    }\r\n    fetchDossiers();\r\n  }, []);\r\n\r\n  const fetchDossiers = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('dossiers')\r\n        .select('*')\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setDossiers(data || []);\r\n\r\n      // R√©cup√©rer les offres pour chaque dossier\r\n      const offresPromises = data.map(async (dossier) => {\r\n        const { data: offresData, error: offresError } = await supabase\r\n          .from('dossier_offres')\r\n          .select(`\r\n            offre_id,\r\n            offres (\r\n              id,\r\n              poste,\r\n              entreprise,\r\n              localisation,\r\n              duree,\r\n              lien,\r\n              created_at\r\n            )\r\n          `)\r\n          .eq('dossier_id', dossier.id);\r\n\r\n        if (offresError) throw offresError;\r\n        return { dossierId: dossier.id, offres: offresData.map(d => d.offres) };\r\n      });\r\n\r\n      const offresResults = await Promise.all(offresPromises);\r\n      const offresMap = offresResults.reduce((acc, { dossierId, offres }) => {\r\n        acc[dossierId] = offres;\r\n        return acc;\r\n      }, {});\r\n      setDossierOffres(offresMap);\r\n    } catch (error) {\r\n      console.error('Erreur lors de la r√©cup√©ration des dossiers:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAccess = async (dossier) => {\r\n    if (user?.role === 'admin') {\r\n      router.push(`/mes-candidatures?dossier_id=${dossier.id}`);\r\n      return;\r\n    }\r\n\r\n    // Si le dossier n'a pas de mot de passe, acc√®s direct\r\n    if (!dossier.mot_de_passe) {\r\n      router.push(`/mes-candidatures?dossier_id=${dossier.id}`);\r\n      return;\r\n    }\r\n\r\n    setSelectedDossier(dossier);\r\n    setPasswordInput('');\r\n    setError('');\r\n  };\r\n\r\n  const handlePasswordSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    try {\r\n      // V√©rifier le mot de passe\r\n      const { data, error } = await supabase\r\n        .from('dossiers')\r\n        .select('*')\r\n        .eq('id', selectedDossier.id)\r\n        .eq('mot_de_passe', passwordInput)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      if (data) {\r\n        // Mot de passe correct, rediriger vers le dossier\r\n        router.push(`/mes-candidatures?dossier_id=${selectedDossier.id}`);\r\n      } else {\r\n        setError('Mot de passe incorrect');\r\n      }\r\n    } catch (error) {\r\n      console.error('Erreur lors de la v√©rification du mot de passe:', error);\r\n      setError('Une erreur est survenue');\r\n    }\r\n  };\r\n\r\n  const handleAddDossier = async () => {\r\n    const { nom, mot_de_passe } = newDossier;\r\n    if (!nom) return alert('Le nom du dossier est requis.');\r\n    \r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('dossiers')\r\n        .insert([{ \r\n          nom, \r\n          mot_de_passe: mot_de_passe || null,\r\n          user_id: user.id \r\n        }])\r\n        .select();\r\n\r\n      if (error) throw error;\r\n\r\n      setDossiers([...dossiers, data[0]]);\r\n      setNewDossier({ nom: '', mot_de_passe: '' });\r\n      setShowAddDossierForm(false);\r\n    } catch (error) {\r\n      console.error('Erreur lors de la cr√©ation du dossier:', error);\r\n      alert('Erreur lors de la cr√©ation du dossier');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground\">\r\n      {/* Main content */}\r\n      <div className=\"p-10\">\r\n        <div className=\"flex justify-between items-center mb-8\">\r\n          <h2 className=\"text-2xl font-bold\">üìÅ Dossiers de candidatures</h2>\r\n          <button\r\n            onClick={() => setShowAddDossierForm(!showAddDossierForm)}\r\n            className=\"button px-2 py-1 rounded-full font-bold shadow transition-all duration-200 hover:scale-105 hover:shadow-lg hover:-translate-y-0.5 text-xs\"\r\n          >\r\n            {showAddDossierForm ? 'Annuler' : 'Cr√©er un dossier'}\r\n          </button>\r\n        </div>\r\n\r\n        {showAddDossierForm && (\r\n          <div className=\"rounded-xl p-6 mb-8 border border-primary bg-white\">\r\n            <h3 className=\"text-xl font-semibold mb-4\">Nouveau dossier</h3>\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-primary mb-2\">\r\n                  Nom du dossier\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={newDossier.nom}\r\n                  onChange={(e) => setNewDossier({ ...newDossier, nom: e.target.value })}\r\n                  className=\"w-full p-2 rounded border border-primary focus:outline-none\"\r\n                  placeholder=\"Ex: Recherche emploi 2024\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-primary mb-2\">\r\n                  Mot de passe (optionnel)\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  value={newDossier.mot_de_passe}\r\n                  onChange={(e) => setNewDossier({ ...newDossier, mot_de_passe: e.target.value })}\r\n                  className=\"w-full p-2 rounded border border-primary focus:outline-none\"\r\n                  placeholder=\"Laissez vide pour un acc√®s sans mot de passe\"\r\n                />\r\n              </div>\r\n              <button\r\n                onClick={handleAddDossier}\r\n                className=\"button px-2 py-1 rounded-full font-bold shadow transition-all duration-200 hover:scale-105 hover:shadow-lg hover:-translate-y-0.5 text-xs\"\r\n              >\r\n                Cr√©er le dossier\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n          {dossiers.map((dossier) => (\r\n            <div key={dossier.id} className=\"rounded-xl p-6 border border-primary bg-white\">\r\n              <h3 className=\"text-xl font-semibold mb-2\">{dossier.nom}</h3>\r\n              <p className=\"text-sm mb-2\">\r\n                Cr√©√© le {new Date(dossier.created_at).toLocaleDateString()}\r\n              </p>\r\n              \r\n              {/* Afficher les offres du dossier */}\r\n              {dossierOffres[dossier.id]?.length > 0 && (\r\n                <div className=\"mb-4\">\r\n                  <h4 className=\"text-sm font-semibold text-primary mb-2\">Offres lik√©es :</h4>\r\n                  <div className=\"space-y-2\">\r\n                    {dossierOffres[dossier.id].map((offre) => (\r\n                      <div key={offre.id} className=\"rounded p-2 text-sm border border-primary bg-gray-100\">\r\n                        <p className=\"font-medium\">{offre.poste}</p>\r\n                        <p className=\"text-sm\">{offre.entreprise}</p>\r\n                        {offre.lien && (\r\n                          <a\r\n                            href={offre.lien}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"text-accent hover:underline text-xs\"\r\n                          >\r\n                            Voir l'offre\r\n                          </a>\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <button\r\n                onClick={() => handleAccess(dossier)}\r\n                className=\"button px-2 py-1 rounded-full font-bold shadow transition-all duration-200 hover:scale-105 hover:shadow-lg hover:-translate-y-0.5 text-xs\"\r\n              >\r\n                {user?.role === 'admin' ? 'Acc√©der' : 'Ouvrir'}\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        {selectedDossier && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\r\n            <div className=\"p-6 rounded-xl w-96 bg-white border border-primary\">\r\n              <h3 className=\"text-xl font-semibold mb-4\">Acc√©der √† {selectedDossier.nom}</h3>\r\n              <form onSubmit={handlePasswordSubmit} className=\"space-y-4\">\r\n                <input\r\n                  type=\"password\"\r\n                  placeholder=\"Mot de passe\"\r\n                  className=\"w-full border px-3 py-2 rounded\"\r\n                  value={passwordInput}\r\n                  onChange={(e) => setPasswordInput(e.target.value)}\r\n                />\r\n                {error && <div className=\"text-error text-sm\">{error}</div>}\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"flex-1 button px-2 py-1 rounded-full font-bold shadow transition-all duration-200 hover:scale-105 hover:shadow-lg hover:-translate-y-0.5 text-xs\"\r\n                  >\r\n                    Acc√©der\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setSelectedDossier(null)}\r\n                    className=\"flex-1 px-2 py-1 rounded-full font-bold shadow transition-all duration-200 hover:scale-105 hover:shadow-lg hover:-translate-y-0.5 text-xs border border-primary\"\r\n                  >\r\n                    Annuler\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n} "],"names":[],"mappings":"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","debugId":null}}]
}